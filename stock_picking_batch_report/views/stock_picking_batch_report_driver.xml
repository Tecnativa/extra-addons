<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="report_batch_picking_from_move">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <div class="page">
                    <style type="text/css">
.fresh-row {
    font-weight: bold;
    color: #fff;
    background-color: #dadada;
}
                    </style>
                    <div class="row mt32 mb16">
                        <div class="col-3">
                            <strong>Date:</strong>
                            <span
                                t-esc="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"
                                t-options="{'widget': 'datetime'}"
                            />
                        </div>
                        <div class="col-3">
                            <strong>Printed by:</strong>
                            <span t-field="user.name" />
                        </div>
                    </div>
                    <t
                        t-set="fresh_attribute_value"
                        t-value="docs.env.ref('product_fishing.product_gamma_f')"
                    />
                    <t t-foreach="docs" t-as="doc">
                        <p t-field="doc.notes" />
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th colspan="2">Batch Ref</th>
                                    <th colspan="5">Picked By</th>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding-bottom:25px;">
                                        <span t-esc="doc.name" />
                                    </td>
                                    <td colspan="3">
                                        <span t-esc="doc.user_id.name" />
                                    </td>
                                    <td
                                        colspan="2"
                                        style="padding-top:25px;"
                                    >Visa:_________________</td>
                                </tr>
                                <tr>
                                    <th id="partner" style="width:30%;"><span
                                        >Partner</span></th>
                                    <th id="product">Product</th>
                                    <t
                                        t-if="'is_elaboration' in doc.env['sale.order.line']"
                                    >
                                        <th id="elaboration">Elaboration</th>
                                    </t>
                                    <th class="text-right">Demanded</th>
                                    <th class="text-right">Qty</th>
                                    <th id="uom_th">UoM</th>
                                    <th />
                                    <th>Lot</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t
                                    t-foreach="doc.move_ids.sorted(lambda x: (x.picking_id.partner_id.display_name, x.product_id.display_name))"
                                    t-as="move"
                                >
                                    <t t-set="product" t-value="move.product_id" />
                                    <t
                                        t-set="qty"
                                        t-value="move.quantity_done or move.reserved_availability"
                                    />
                                    <t t-set="op" t-value="move.move_line_ids[:1]" />
                                    <t
                                        t-set="secondary_uom"
                                        t-value="move.secondary_uom_id"
                                    />
                                    <t
                                        t-set="secondary_uom_qty"
                                        t-value="move.secondary_uom_qty"
                                    />
                                    <tr
                                        name="fresh_bg"
                                        t-att-class="'fresh-row' if fresh_attribute_value.id in move.product_id.gamma_ids.ids else ''"
                                    >
                                        <td id="partner">
                                            <span
                                                t-field="move.picking_id.partner_id.display_name"
                                            />
                                        </td>
                                        <td id="product">
                                            <span t-field="move.name" />
                                        </td>
                                        <t
                                            t-if="'is_elaboration' in doc.env['sale.order.line']"
                                        >
                                            <td id="elaboration">
                                                <span
                                                    t-field="move.sale_line_id.elaboration_note"
                                                />
                                            </td>
                                        </t>
                                        <td id="initial_demand" class="text-right">
                                            <span t-field="move.product_uom_qty" />
                                        </td>
                                        <td id="qty" class="text-right">
                                            <span
                                                t-esc="qty"
                                                t-options="{'widget': 'float', 'precision': currency_precision}"
                                                style="font-size:14px"
                                                t-attf-class="#{product.weight_type == 'variable' and 'd-none'}"
                                            />
                                        </td>
                                        <td>
                                            <span t-field="move.product_uom" />
                                        </td>
                                        <td>
                                            <t t-if="secondary_uom">
                                                <strong
                                                    t-esc="secondary_uom_qty"
                                                    t-options="{'widget': 'float', 'precision': currency_precision}"
                                                /> <strong t-esc="secondary_uom.name" />
                                            </t>
                                        </td>
                                        <td>
                                            <div
                                                t-foreach="move.move_line_ids.mapped('lot_id')"
                                                t-as="lot"
                                            >
                                                <span t-field="lot.name" />
                                                <t t-if="expiration_date">
                                                    <span>(<span
                                                            t-field="lot.expiration_date"
                                                            t-options="{'widget': 'date'}"
                                                        />)</span>
                                                </t>
                                            </div>
                                        </td>
                                        <tr
                                            align="left"
                                            t-if="product.description_warehouse"
                                        >
                                            <td colspan="4">
                                                <pre class="description ">
                                                    <span
                                                        t-esc="product.description_warehouse"
                                                    />
                                                </pre>
                                            </td>
                                        </tr>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div
                            t-foreach="doc.picking_ids.filtered('note')"
                            t-as="pick_with_note"
                        >
                            <span t-field="pick_with_note.note" />
                        </div>
                        <div id="batch_break" style="page-break-before:always;" />
                    </t>
                </div>
            </t>
        </t>
    </template>

</odoo>
