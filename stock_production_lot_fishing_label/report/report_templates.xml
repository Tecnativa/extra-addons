<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="basic_layout_fishing_label_freezing">
        <span
            t-if="env.ref('product_fishing.product_gamma_c') in o['product_id'].gamma_ids"
        >Freezing</span>
        <span t-else="">Packed</span>
    </template>
    <template id="basic_layout_fishing_label_expiration">
        <span>Expiration</span>
    </template>
    <template id="basic_layout_fishing_label_lot_num">
        <span>Batch No.</span>
    </template>
    <template id="basic_layout_fishing_label_net_weight">
        <span>Net Weight</span>
    </template>
    <template id="basic_layout_fishing_label_drained_weight">
        <span>Drained Weight</span>
    </template>
    <template id="basic_layout_fishing_label">
        <t t-call="web.html_container">
            <t
                t-set="show_client_elaborations"
                t-value="client_elaborations[doc['id']]"
            />
            <t t-set="langs" t-value="report_langs[doc['id']]" />
            <t t-set="data_report_margin_top" t-value="30 if len(langs) == 4 else 21" />
            <t
                t-set="data_report_margin_top"
                t-value="data_report_margin_top + 3 if show_client_elaborations else data_report_margin_top"
            />
            <t
                t-set="data_report_margin_top"
                t-value="data_report_margin_top - 1 if summarized else data_report_margin_top"
            />
            <t
                t-set="data_report_header_spacing"
                t-value="30 if len(langs) == 4 else 21"
            />
            <t
                t-set="data_report_header_spacing"
                t-value="data_report_header_spacing + 3 if show_client_elaborations else data_report_header_spacing"
            />
            <t
                t-set="data_report_header_spacing"
                t-value="data_report_header_spacing - 1 if summarized else data_report_header_spacing"
            />
            <t t-if="not o" t-set="o" t-value="doc" />
            <t
                t-set="o"
                t-value="o['move_line_id'] if doc_model == 'stock.picking.line.print' and not summarized else o"
            />
            <t t-if="not company">
                <!-- Multicompany -->
                <t t-if="company_id">
                    <t t-set="company" t-value="company_id" />
                </t>
                <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                    <t t-set="company" t-value="o.company_id.sudo()" />
                </t>
                <t t-else="else">
                    <t t-set="company" t-value="res_company" />
                </t>
            </t>
            <!-- Header -->
            <div class="header">
                <div class="row">
                    <div class="col-12 text-center" t-if="show_client_elaborations">
                        <strong
                            style="font-size: 18pt;"
                            t-if="doc_model != 'stock.quant'"
                            t-field="o['picking_partner_id'].display_name"
                        />
                    </div>
                </div>
                <div class="row" t-if="summarized">
                    <div class="col-12 text-right">
                        <strong style="font-size: 45pt;">
                            CAJA MASTER BOX
                        </strong>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <t t-foreach="langs" t-as="lang">
                            <strong
                                style="font-size: 20pt;"
                                t-field="o['product_id'].with_context(lang=lang).name"
                            />
                            <br t-if="lang != langs[-1]" />
                        </t>
                    </div>
                </div>
                <div class="row">
                    <div
                        class="col-12 text-right"
                        style="font-size: 13pt;"
                        id="extra_heading"
                    >
                        <div
                            t-if="show_client_elaborations and doc_model != 'stock.quant' and o['move_id'].elaboration_ids"
                        >
                            <i
                                t-out="', '.join(o['move_id'].elaboration_ids.with_context(lang='ca_ES').mapped(lambda e: '*' + e.name))"
                            />
                            <br />
                            <i
                                t-out="', '.join(o['move_id'].elaboration_ids.with_context(lang=o['move_id'].picking_id.partner_id.lang).mapped(lambda e: '*' + e.display_name))"
                            />
                        </div>
                    </div>
                </div>
                <t
                    t-set="precision"
                    t-value="env['decimal.precision'].precision_get('Product Unit of Measure')"
                />
                <div t-if="summarized" style="border-top: 1px solid black;" />
                <table
                    t-if="not summarized"
                    class="text-center"
                    style="border-top: 1px solid black;border-bottom: 1px solid black;font-size: 16pt;width:100%"
                >
                    <tbody>
                        <tr>
                            <td>
                                <t t-foreach="langs" t-as="lang">
                                    <t
                                        t-call="stock_production_lot_fishing_label.basic_layout_fishing_label_freezing"
                                        t-lang="lang"
                                    />
                                    <span t-if="lang != langs[-1]"> / </span>
                                </t>
                            </td>
                            <td>
                                <t t-foreach="langs" t-as="lang">
                                    <t
                                        t-call="stock_production_lot_fishing_label.basic_layout_fishing_label_expiration"
                                        t-lang="lang"
                                    />
                                    <span t-if="lang != langs[-1]"> / </span>
                                </t>
                            </td>
                            <td>
                                <t t-foreach="langs" t-as="lang">
                                    <t
                                        t-call="stock_production_lot_fishing_label.basic_layout_fishing_label_lot_num"
                                        t-lang="lang"
                                    />
                                    <span t-if="lang != langs[-1]"> / </span>
                                </t>
                            </td>
                            <td>
                                <t t-foreach="langs" t-as="lang">
                                    <t
                                        t-call="stock_production_lot_fishing_label.basic_layout_fishing_label_net_weight"
                                        t-lang="lang"
                                    />
                                    <span t-if="lang != langs[-1]"> / </span>
                                </t>
                            </td>
                            <td
                                t-if="not float_is_zero(o['product_id'].drained_weight, precision_digits=precision)"
                            >
                                <t t-foreach="langs" t-as="lang">
                                    <t
                                        t-call="stock_production_lot_fishing_label.basic_layout_fishing_label_drained_weight"
                                        t-lang="lang"
                                    />
                                    <span t-if="lang != langs[-1]"> / </span>
                                </t>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <!-- TODO: Freezing date -->
                                <strong
                                    t-field="o['lot_id'].packaging_date"
                                    t-options='{"widget": "date"}'
                                />
                            </td>
                            <td>
                                <strong
                                    t-field="o['lot_id'].expiration_date"
                                    t-options='{"widget": "date"}'
                                />
                            </td>
                            <td><strong t-field="o['lot_id'].display_name" /></td>
                            <td>
                                <t
                                    t-if="o['product_uom_id'].category_id == env.ref('uom.product_uom_categ_kgm')"
                                >
                                    <strong
                                        t-if="doc_model in ['stock.quant', 'stock.picking.line.print']"
                                        t-out="doc['quantity']"
                                    />
                                    <strong t-else="" t-out="o['qty_done']" />
                                    <strong
                                        t-field="o['product_uom_id'].display_name"
                                    />
                                </t>
                                <t t-else="">
                                    <strong
                                        t-if="doc_model in ['stock.quant', 'stock.picking.line.print']"
                                        t-out="doc['quantity'] * o['product_id'].net_weight"
                                    />
                                    <strong
                                        t-else=""
                                        t-out="o['qty_done'] * o['product_id'].net_weight"
                                    />
                                    <strong t-field="o['product_id'].weight_uom_name" />
                                </t>
                            </td>
                            <td
                                t-if="not float_is_zero(o['product_id'].drained_weight, precision_digits=precision)"
                            >
                                <t
                                    t-if="o['product_uom_id'].category_id == env.ref('uom.product_uom_categ_kgm')"
                                >
                                    <!-- TODO: Asegurarse del cálculo -->
                                    <strong
                                        t-if="doc_model in ['stock.quant', 'stock.picking.line.print']"
                                        t-out="doc['quantity'] * (o['product_id'].drained_weight / o['product_id'].net_weight)"
                                    />
                                    <strong
                                        t-else=""
                                        t-out="o['qty_done'] * (o['product_id'].drained_weight / o['product_id'].net_weight)"
                                    />
                                    <strong
                                        t-field="o['product_uom_id'].display_name"
                                    />
                                </t>
                                <t t-else="">
                                    <strong
                                        t-if="doc_model == 'stock.quant'"
                                        t-out="o['quantity'] * o['product_id'].drained_weight"
                                    />
                                    <strong
                                        t-else=""
                                        t-out="o['qty_done'] * o['product_id'].drained_weight"
                                    />
                                    <strong t-field="o['product_id'].weight_uom_name" />
                                </t>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Content -->
            <div
                class="article"
                t-att-data-oe-model="doc_model"
                t-att-data-oe-lang="env.context.get('lang')"
            >
                <t t-out="0" />
            </div>
            <!-- Footer -->
            <div class="footer o_standard_footer">
                <div class="row">
                    <div class="col-3">
                        <ul class="list-unstyled">
                            <strong style="font-size: 15pt;"><li
                                    t-if="company.name"
                                ><span t-field="company.name" /></li></strong>
                            <li>
                                <small t-field="company.street" />
                                <small t-field="company.zip" />
                                <small t-field="company.city" />
                                <small> - </small>
                                <small t-field="company.country_id" />
                            </li>
                            <li t-if="company.phone">Tel. <span
                                    class="o_force_ltr"
                                    t-field="company.phone"
                                /></li>
                            <li t-if="company.website"><span
                                    t-field="company.website"
                                /></li>
                        </ul>
                    </div>
                    <div class="col-2">
                        <t
                            t-call="company_sanitary_registry.sanitary_registry_template"
                        />
                    </div>
                    <div class="col-5">
                        <div class="row pl-3">
                            <div class="col">
                                <t
                                    t-set="barcode"
                                    t-value="'240' + o['product_id'].default_code + '10' + o['lot_id'].name if not summarized else o['master_box_id'].name"
                                />
                                <img
                                    t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;quiet=0&amp;height=%s&amp;width=%s&amp;' % ('gs1_128', barcode, 60, 30)"
                                    style="width:100%;height:60px"
                                />
                            </div>
                        </div>
                        <div class="row pl-3">
                            <div
                                class="col"
                                style="text-align:center; font-size: 12pt;"
                            >
                                <span
                                    t-out="'(240)' + o['product_id'].default_code + '(10)' + o['lot_id'].name if not summarized else o['master_box_id'].name"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="col-2 text-center">
                        <strong
                            t-if="doc_model != 'stock.quant' and not summarized"
                            style="font-size: 25pt"
                            t-out="o['result_package_id'].alias or o['result_package_id'].display_name"
                        />
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
